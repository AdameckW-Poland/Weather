<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Pogoda">
    
    <title>TERMINAL RADZIONKÓW</title>
    
    <style>
        :root { --bg: #ffffff; --box: #f4f4f4; --txt: #000; --muted: #666; }
        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body { 
            background: var(--bg); color: var(--txt); margin: 0; padding: 0;
            font-family: Arial, Helvetica, sans-serif; 
            width: 100vw; height: 100dvh; display: flex; overflow: hidden;
        }

        .widget { width: 100%; height: 100%; display: flex; flex-direction: column; padding: 2vmin 4vmin; }

        /* NAGŁÓWEK */
        .header { border-bottom: 3px solid #000; padding-bottom: 1vmin; margin-bottom: 2vmin; flex-shrink: 0; }
        .header-top { display: flex; justify-content: space-between; align-items: baseline; }
        .city { 
            font-size: 7vmin; 
            text-transform: uppercase; 
            letter-spacing: 8px; 
            font-family: "Arial Black", sans-serif;
            line-height: 1;
        }
        .time { font-size: 3.5vmin; font-weight: 900; text-transform: uppercase; }
        .header-sub { display: flex; justify-content: space-between; font-size: 1.8vmin; color: var(--muted); margin-top: 0.5vmin; font-weight: 700; }

        /* PANEL GŁÓWNY */
        .main-grid { display: flex; gap: 2vmin; height: 38vmin; margin-bottom: 2vmin; flex-shrink: 0; }
        .box { background: var(--box); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2vmin; }
        
        .box-temp { width: 33%; }
        .temp-row { display: flex; align-items: center; gap: 2vmin; }
        .main-temp { font-size: 14vmin; font-weight: 900; letter-spacing: -5px; line-height: 1; }
        
        .trend-container { display: flex; flex-direction: column; align-items: center; margin-left: 3vmin; }
        .trend-label { font-size: 1.2vmin; font-weight: 900; color: var(--muted); margin-bottom: -0.5vmin; }
        .temp-trend { font-size: 7vmin; font-weight: 400; }

        /* IKONY - FILTR SKALI SZAROŚCI */
        .main-icon { 
            width: 16vmin; height: 16vmin; 
            filter: grayscale(100%) contrast(1.1); 
            opacity: 0.9;
        }
        .f-icon { 
            width: 8vmin; height: 8vmin; 
            filter: grayscale(100%); 
            opacity: 0.7;
            vertical-align: middle; 
        }

        .feels { font-size: 2.5vmin; font-weight: 900; background: #000; color: #fff; padding: 6px 15px; margin-top: 2vmin; }

        .box-info { width: 34%; align-items: flex-start; padding-left: 4vmin; }
        .condition { font-size: 2.8vmin; font-weight: 900; text-transform: uppercase; margin-bottom: 2vmin; border-bottom: 2px solid #000; width: 95%; }
        .line { font-size: 2.4vmin; font-weight: 700; margin-bottom: 1.2vmin; display: flex; align-items: center; gap: 2vmin; }
        .w-tag { background: #ddd; padding: 4px 12px; border-radius: 4px; display: flex; align-items: center; gap: 1.5vmin; font-size: 2vmin; }
        
        /* WYKRES CIŚNIENIA */
        .box-trends { width: 33%; padding: 1.5vmin; }
        .chart-title { font-size: 1.7vmin; font-weight: 900; text-transform: uppercase; margin-bottom: 1.5vmin; text-align: center; color: var(--muted); }
        .chart-area { width: 100%; height: 60%; display: flex; align-items: flex-end; justify-content: space-around; gap: 4px; }
        .bar { background: #000; width: 80%; min-height: 4px; border-radius: 2px 2px 0 0; }
        .bar-label { font-size: 1.4vmin; font-weight: 900; color: var(--muted); margin-top: 5px; }

        /* TABELA */
        .f-table { width: 100%; border-collapse: collapse; flex-grow: 1; table-layout: fixed; }
        .f-table th { font-size: 1.7vmin; color: var(--muted); text-transform: uppercase; padding-bottom: 1vmin; }
        .f-table td { border-top: 2px solid #eee; padding: 1.2vmin 0; vertical-align: middle; text-align: center; }
        .f-day-box { text-align: left; }
        .f-day-name { font-size: 3vmin; font-weight: 900; text-transform: uppercase; display: block; line-height: 1; }
        .f-day-date { font-size: 1.8vmin; font-weight: 700; color: var(--muted); }
        .f-temp { font-size: 4.8vmin; font-weight: 900; margin-left: 1vmin; }
    </style>
</head>
<body>
    <div class="widget">
        <div class="header">
            <div class="header-top">
                <div class="city">Radzionków</div>
                <div class="time" id="clock">--:--</div>
            </div>
            <div class="header-sub">
                <div>WSCHÓD: <b id="sunrise" style="color:#000">--:--</b> | ZACHÓD: <b id="sunset" style="color:#000">--:--</b></div>
                <div>ŹRÓDŁO: MET NORWAY | STATUS: <span id="status">...</span></div>
            </div>
        </div>

        <div class="main-grid">
            <div class="box box-temp">
                <div class="temp-row">
                    <img id="m-icon" class="main-icon" src="">
                    <div style="display: flex; align-items: center;">
                        <span class="main-temp" id="m-temp">--°</span>
                        <div class="trend-container">
                            <span class="trend-label">TREND TEMP.</span>
                            <span class="temp-trend" id="t-trend"></span>
                        </div>
                    </div>
                </div>
                <div class="feels">ODCZUWALNA: <span id="f-temp">--</span>°C</div>
            </div>

            <div class="box box-info">
                <div class="condition" id="m-desc">ŁADOWANIE...</div>
                <div class="line">WIATR: <b id="w-speed">--</b> km/h 
                    <div class="w-tag">
                        <svg id="w-arr" width="24" height="24" viewBox="0 0 100 100" style="transition:1s"><path d="M50 5 L65 95 L50 80 L35 95 Z" fill="black"/></svg>
                        <span id="w-meta">--</span>
                    </div>
                </div>
                <div class="line">CIŚNIENIE: <b id="press">--</b> hPa</div>
                <div class="line">WILGOTNOŚĆ: <b id="humid">--</b> %</div>
            </div>

            <div class="box box-trends">
                <div class="chart-title">Trend Barometryczny (12h)</div>
                <div class="chart-area" id="pressure-chart"></div>
            </div>
        </div>

        <table class="f-table">
            <thead>
                <tr><th width="25%" align="left">Dzień</th><th width="25%">Rano</th><th width="25%">Południe</th><th width="25%">Wieczór</th></tr>
            </thead>
            <tbody id="f-body"></tbody>
        </table>
    </div>

    <script>
        const LOC = { lat: 50.39, lon: 18.90 };
        const trans = {
            'clearsky': 'Czyste niebo', 'fair': 'Pogodnie', 'partlycloudy': 'Zachmurzenie', 'cloudy': 'Pochmurno',
            'lightrain': 'Lekki deszcz', 'rain': 'Deszcz', 'heavyrain': 'Ulewa', 'lightsnow': 'Lekki śnieg',
            'snow': 'Śnieg', 'heavysnow': 'Śnieżyca', 'fog': 'Mgła', 'sleet': 'Deszcz ze śniegiem',
            'lightrainshowers': 'Przelotny deszcz', 'rainshowers': 'Deszcz', 'heavyrainshowers': 'Ulewa',
            'lightsnowshowers': 'Przelotny śnieg'
        };

        function getIconUrl(code) {
            const rawUrl = `https://raw.githubusercontent.com/metno/weathericons/main/weather/svg/${code}.svg`;
            return "https://corsproxy.io/?" + encodeURIComponent(rawUrl);
        }

        async function getSun() {
            try {
                const r = await fetch(`https://api.sunrise-sunset.org/json?lat=${LOC.lat}&lng=${LOC.lon}&formatted=0`);
                const d = await r.json();
                const formatTime = (isoStr) => new Date(isoStr).toLocaleTimeString('pl-PL', {hour: '2-digit', minute: '2-digit'});
                document.getElementById('sunrise').innerText = formatTime(d.results.sunrise);
                document.getElementById('sunset').innerText = formatTime(d.results.sunset);
            } catch (e) { console.error("Błąd słońca"); }
        }

        function updateClock() {
            const now = new Date();
            const days = ['NIEDZIELA','PONIEDZIAŁEK','WTOREK','ŚRODA','CZWARTEK','PIĄTEK','SOBOTA'];
            document.getElementById('clock').innerText = `${days[now.getDay()]}, ${now.toLocaleDateString('pl-PL', {day:'2-digit', month:'2-digit'})} | ${now.toLocaleTimeString('pl-PL', {hour:'2-digit', minute:'2-digit'})}`;
        }

        async function update() {
            const target = `https://api.met.no/weatherapi/locationforecast/2.0/complete?lat=${LOC.lat}&lon=${LOC.lon}`;
            const proxy = "https://corsproxy.io/?" + encodeURIComponent(target);

            try {
                const r = await fetch(proxy);
                const d = await r.json();
                const series = d.properties.timeseries;
                const inst = series[0].data.instant.details;

                // Main data
                document.getElementById('m-temp').innerText = Math.round(inst.air_temperature) + '°';
                const nextT = series[1].data.instant.details.air_temperature;
                document.getElementById('t-trend').innerText = Math.abs(nextT - inst.air_temperature) < 0.2 ? '→' : (nextT > inst.air_temperature ? '↗' : '↘');

                const ws = inst.wind_speed * 3.6;
                let fl = inst.air_temperature;
                if(fl <= 10 && ws > 4) fl = 13.12 + 0.6215*fl - 11.37*Math.pow(ws, 0.16) + 0.3965*fl*Math.pow(ws, 0.16);
                document.getElementById('f-temp').innerText = fl.toFixed(1);

                document.getElementById('press').innerText = Math.round(inst.air_pressure_at_sea_level);
                document.getElementById('humid').innerText = Math.round(inst.relative_humidity);
                document.getElementById('w-speed').innerText = Math.round(ws);
                document.getElementById('w-arr').style.transform = `rotate(${inst.wind_from_direction + 180}deg)`;
                const dirs = ['N','NE','E','SE','S','SW','W','NW'];
                document.getElementById('w-meta').innerText = Math.round(inst.wind_from_direction) + '° ' + dirs[Math.round(inst.wind_from_direction/45)%8];

                const symCode = series[0].data.next_1_hours.summary.symbol_code;
                document.getElementById('m-icon').src = getIconUrl(symCode);
                const cleanSym = symCode.split('_')[0];
                document.getElementById('m-desc').innerText = (trans[cleanSym] || cleanSym).toUpperCase();
                
                // Pressure chart
                const chart = document.getElementById('pressure-chart');
                chart.innerHTML = '';
                let points = [];
                for(let i=0; i<7; i++) {
                    const data = series[i*2];
                    if(data) points.push({ v: data.data.instant.details.air_pressure_at_sea_level, h: new Date(data.time).getHours() });
                }
                const vals = points.map(p => p.v);
                const min = Math.min(...vals) - 0.5;
                const max = Math.max(...vals) + 0.5;
                const range = max - min;
                points.forEach(p => {
                    const group = document.createElement('div');
                    group.style.cssText = "display:flex; flex-direction:column; align-items:center; flex:1; height:100%; justify-content:flex-end;";
                    const height = ((p.v - min) / (range || 1)) * 100;
                    group.innerHTML = `<div class="bar" style="height:${Math.max(height, 5)}%"></div><div class="bar-label">${p.h}:00</div>`;
                    chart.appendChild(group);
                });

                // Forecast Table
                const daily = {};
                series.forEach(ts => { const date = ts.time.split('T')[0]; if(!daily[date]) daily[date] = []; daily[date].push(ts); });
                const body = document.getElementById('f-body');
                body.innerHTML = '';
                const daysMap = ['NIEDZIELA','PONIEDZIAŁEK','WTOREK','ŚRODA','CZWARTEK','PIĄTEK','SOBOTA'];

                Object.keys(daily).slice(1, 4).forEach(day => {
                    const dt = new Date(day);
                    let row = `<tr><td class="f-day-box"><span class="f-day-name">${daysMap[dt.getDay()]}</span><span class="f-day-date">${dt.toLocaleDateString('pl-PL', {day:'2-digit', month:'2-digit'})}</span></td>`;
                    [8, 13, 20].forEach(h => {
                        const s = daily[day].reduce((a,b) => Math.abs(new Date(b.time).getHours()-h) < Math.abs(new Date(a.time).getHours()-h) ? b : a);
                        const ico = s.data.next_6_hours ? s.data.next_6_hours.summary.symbol_code : s.data.next_1_hours.summary.symbol_code;
                        row += `<td><img class="f-icon" src="${getIconUrl(ico)}"><span class="f-temp">${Math.round(s.data.instant.details.air_temperature)}°</span></td>`;
                    });
                    body.innerHTML += row + `</tr>`;
                });

                document.getElementById('status').innerText = "OK";
            } catch(e) { document.getElementById('status').innerText = "BŁĄD"; }
        }

        setInterval(updateClock, 1000);
        setInterval(update, 600000);
        updateClock(); update(); getSun();
    </script>
</body>
</html>
